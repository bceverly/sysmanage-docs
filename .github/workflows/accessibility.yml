name: Accessibility Check
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  accessibility:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - name: Setup Node.js
        uses: actions/setup-node@v5
        with:
          node-version: '20'
      - name: Install pa11y and http-server
        run: |
          npm install -g pa11y http-server
      - name: Start HTTP server
        run: |
          http-server . -p 8080 &
          sleep 5
      - name: Run accessibility tests
        run: |
          # Test main pages
          pa11y --no-sandbox http://localhost:8080/index.html
          pa11y --no-sandbox http://localhost:8080/docs/index.html

          # Test key documentation pages (if they exist)
          if [ -f "docs/api/index.html" ]; then
            pa11y --no-sandbox http://localhost:8080/docs/api/index.html
          fi

          if [ -f "docs/agent/index.html" ]; then
            pa11y --no-sandbox http://localhost:8080/docs/agent/index.html
          fi

          if [ -f "docs/server/index.html" ]; then
            pa11y --no-sandbox http://localhost:8080/docs/server/index.html
          fi