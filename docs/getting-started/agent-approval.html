<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Setup and Approval - SysManage</title>
    <meta name="description" content="Complete guide for installing, configuring, and approving SysManage agents on your hosts for comprehensive monitoring.">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="icon" type="image/svg+xml" href="/assets/images/favicon.svg">
</head>
<body data-auto-header="documentation" data-auto-footer>
    <!-- Header injected automatically by components.js -->

    <main class="docs-main">
        <div class="container">
            <div class="docs-breadcrumb">
                <a href="../">Documentation</a> > <a href="./">Getting Started</a> > <span>Agent Setup</span>
            </div>

            <div class="docs-header">
                <h1>Agent Setup and Approval</h1>
                <p>Learn how to install, configure, and approve SysManage agents on your hosts for comprehensive monitoring.</p>
            </div>

            <div class="docs-content">
                <section class="overview">
                    <h2>Agent Overview</h2>
                    <p>SysManage agents are lightweight programs that run on your hosts to collect system information, manage packages, and execute administrative tasks. Agents communicate securely with the SysManage server using mTLS authentication.</p>

                    <div class="alert alert-info">
                        <strong>Prerequisites:</strong> Ensure your SysManage server is running and accessible. Complete the <a href="first-deployment.html">First Deployment</a> guide if needed.
                    </div>

                    <h3>Agent Features</h3>
                    <ul>
                        <li><strong>System Monitoring:</strong> Hardware specs, uptime, resource usage</li>
                        <li><strong>Package Management:</strong> Inventory, updates, installations</li>
                        <li><strong>Security Updates:</strong> Automated detection and installation</li>
                        <li><strong>Cross-Platform:</strong> Linux, BSD, macOS, Windows support</li>
                        <li><strong>Secure Communication:</strong> mTLS encryption and authentication</li>
                        <li><strong>Privileged Operations:</strong> Configurable sudo access</li>
                    </ul>
                </section>

                <section class="agent-installation">
                    <h2>1. Agent Installation</h2>

                    <h3>Linux Installation</h3>
                    <div class="code-section">
                        <h4>Ubuntu/Debian</h4>
                        <pre><code class="language-bash"># Download and install agent
wget https://github.com/bceverly/sysmanage-agent/releases/latest/download/sysmanage-agent-linux-amd64.deb
sudo dpkg -i sysmanage-agent-linux-amd64.deb

# Or install from source
git clone https://github.com/bceverly/sysmanage-agent.git
cd sysmanage-agent
sudo make install</code></pre>
                    </div>

                    <div class="code-section">
                        <h4>RHEL/CentOS/Fedora</h4>
                        <pre><code class="language-bash"># Download and install agent
wget https://github.com/bceverly/sysmanage-agent/releases/latest/download/sysmanage-agent-linux-amd64.rpm
sudo rpm -i sysmanage-agent-linux-amd64.rpm

# Or install from source
git clone https://github.com/bceverly/sysmanage-agent.git
cd sysmanage-agent
sudo make install</code></pre>
                    </div>

                    <div class="code-section">
                        <h4>Arch Linux</h4>
                        <pre><code class="language-bash"># Install from AUR
yay -S sysmanage-agent

# Or install from source
git clone https://github.com/bceverly/sysmanage-agent.git
cd sysmanage-agent
sudo make install</code></pre>
                    </div>

                    <h3>BSD Installation</h3>
                    <div class="code-section">
                        <h4>FreeBSD</h4>
                        <pre><code class="language-bash"># Install from ports
cd /usr/ports/sysutils/sysmanage-agent
make install clean

# Or install package
pkg install sysmanage-agent</code></pre>
                    </div>

                    <div class="code-section">
                        <h4>OpenBSD</h4>
                        <pre><code class="language-bash"># Install package
pkg_add sysmanage-agent

# Or install from source
git clone https://github.com/bceverly/sysmanage-agent.git
cd sysmanage-agent
doas make install</code></pre>
                    </div>

                    <h3>macOS Installation</h3>
                    <div class="code-section">
                        <h4>Homebrew</h4>
                        <pre><code class="language-bash"># Install via Homebrew
brew tap bceverly/sysmanage
brew install sysmanage-agent</code></pre>
                    </div>

                    <div class="code-section">
                        <h4>Manual Installation</h4>
                        <pre><code class="language-bash"># Download and install
curl -L https://github.com/bceverly/sysmanage-agent/releases/latest/download/sysmanage-agent-darwin-amd64.pkg -o sysmanage-agent.pkg
sudo installer -pkg sysmanage-agent.pkg -target /</code></pre>
                    </div>

                    <h3>Windows Installation</h3>
                    <div class="code-section">
                        <h4>MSI Installer</h4>
                        <pre><code class="language-powershell"># Download and install MSI package
Invoke-WebRequest -Uri "https://github.com/bceverly/sysmanage-agent/releases/latest/download/sysmanage-agent-windows-amd64.msi" -OutFile "sysmanage-agent.msi"
Start-Process msiexec.exe -ArgumentList "/i sysmanage-agent.msi /quiet" -Wait</code></pre>
                    </div>

                    <div class="code-section">
                        <h4>Chocolatey</h4>
                        <pre><code class="language-powershell"># Install via Chocolatey
choco install sysmanage-agent</code></pre>
                    </div>
                </section>

                <section class="agent-configuration">
                    <h2>2. Agent Configuration</h2>

                    <h3>Configuration File Location</h3>
                    <p>The agent configuration file is located at:</p>
                    <ul>
                        <li><strong>Linux/BSD:</strong> <code>/etc/sysmanage-agent/sysmanage-agent.yaml</code></li>
                        <li><strong>macOS:</strong> <code>/usr/local/etc/sysmanage-agent/sysmanage-agent.yaml</code></li>
                        <li><strong>Windows:</strong> <code>C:\Program Files\SysManage Agent\config\sysmanage-agent.yaml</code></li>
                    </ul>

                    <h3>Basic Configuration</h3>
                    <p>Edit the configuration file with your server details:</p>
                    <pre><code class="language-yaml"># SysManage Agent Configuration
server:
  host: "sysmanage.yourdomain.com"
  port: 8444
  ssl_enabled: true
  ssl_verify: true

# Agent identification
agent:
  name: "web-server-01"
  tags:
    - "production"
    - "web"
    - "critical"
  location: "datacenter-1"

# Certificate paths (auto-generated on first run)
security:
  cert_file: "/etc/sysmanage-agent/certs/agent.crt"
  key_file: "/etc/sysmanage-agent/certs/agent.key"
  ca_file: "/etc/sysmanage-agent/certs/ca.crt"

# Package management
packages:
  enabled: true
  auto_update_security: false
  excluded_packages:
    - "kernel*"
    - "grub*"

# System monitoring
monitoring:
  enabled: true
  interval: 300  # 5 minutes
  collect_metrics: true
  collect_logs: false

# Privileged operations
privileged:
  enabled: false
  allowed_commands: []

logging:
  level: "INFO"
  file: "/var/log/sysmanage-agent/agent.log"</code></pre>

                    <h3>Advanced Configuration Options</h3>

                    <h4>Network Configuration</h4>
                    <pre><code class="language-yaml">network:
  connection_timeout: 30
  retry_attempts: 3
  retry_delay: 5
  proxy:
    enabled: false
    url: "http://proxy.company.com:8080"
    username: ""
    password: ""</code></pre>

                    <h4>Security Configuration</h4>
                    <pre><code class="language-yaml">security:
  # Certificate validation
  ssl_verify: true
  ssl_cert_file: "/path/to/server.crt"

  # Client certificate authentication
  cert_file: "/etc/sysmanage-agent/certs/agent.crt"
  key_file: "/etc/sysmanage-agent/certs/agent.key"

  # Auto-enrollment settings
  auto_enroll: true
  enrollment_token: "your-enrollment-token"</code></pre>
                </section>

                <section class="certificate-setup">
                    <h2>3. Certificate Setup</h2>

                    <h3>Automatic Certificate Generation</h3>
                    <p>On first startup, the agent automatically generates a certificate signing request (CSR) and submits it to the server for approval:</p>

                    <pre><code class="language-bash"># Start the agent service
sudo systemctl start sysmanage-agent

# Check agent logs for certificate generation
sudo journalctl -u sysmanage-agent -f</code></pre>

                    <p>You should see log entries similar to:</p>
                    <pre><code class="language-text">INFO: Generating new certificate key pair
INFO: Creating certificate signing request
INFO: Submitting CSR to server for approval
INFO: Waiting for certificate approval...</code></pre>

                    <h3>Manual Certificate Setup</h3>
                    <p>For environments requiring manual certificate management:</p>

                    <div class="code-section">
                        <h4>Generate Certificate Request</h4>
                        <pre><code class="language-bash"># Generate private key
openssl genrsa -out agent.key 2048

# Generate certificate signing request
openssl req -new -key agent.key -out agent.csr \
    -subj "/CN=web-server-01/O=YourOrganization"

# Submit CSR to SysManage server
curl -k -X POST https://sysmanage.yourdomain.com:8444/api/agent/csr \
    -H "Content-Type: application/json" \
    -d '{"csr": "'$(base64 -w 0 agent.csr)'", "hostname": "web-server-01"}'</code></pre>
                    </div>

                    <h3>Certificate Verification</h3>
                    <p>Verify certificate setup is working:</p>
                    <pre><code class="language-bash"># Test certificate
openssl x509 -in /etc/sysmanage-agent/certs/agent.crt -text -noout

# Test connection to server
sysmanage-agent --test-connection</code></pre>
                </section>

                <section class="server-approval">
                    <h2>4. Server-Side Agent Approval</h2>

                    <h3>Web Interface Approval</h3>
                    <ol>
                        <li>Log into the SysManage web interface</li>
                        <li>Navigate to <strong>Hosts</strong> → <strong>Pending Approval</strong></li>
                        <li>Review the pending agent certificate requests</li>
                        <li>Verify the agent details (hostname, IP, fingerprint)</li>
                        <li>Click <strong>Approve</strong> to approve the agent</li>
                    </ol>

                    <h3>CLI Approval</h3>
                    <p>Approve agents using the command line interface:</p>
                    <pre><code class="language-bash"># List pending approvals
sysmanage-cli agent list-pending

# Approve specific agent
sysmanage-cli agent approve --hostname web-server-01 --fingerprint SHA256:abc123...

# Approve all pending agents (use with caution)
sysmanage-cli agent approve-all</code></pre>

                    <h3>API Approval</h3>
                    <p>Approve agents programmatically via API:</p>
                    <pre><code class="language-bash"># Get pending approvals
curl -k -H "Authorization: Bearer $JWT_TOKEN" \
    https://sysmanage.yourdomain.com:8443/api/agents/pending

# Approve agent
curl -k -X POST -H "Authorization: Bearer $JWT_TOKEN" \
    -H "Content-Type: application/json" \
    https://sysmanage.yourdomain.com:8443/api/agents/approve \
    -d '{"agent_id": "agent-uuid", "approved": true}'</code></pre>
                </section>

                <section class="service-management">
                    <h2>5. Service Management</h2>

                    <h3>Linux/BSD Service Management</h3>
                    <pre><code class="language-bash"># Enable and start service
sudo systemctl enable sysmanage-agent
sudo systemctl start sysmanage-agent

# Check service status
sudo systemctl status sysmanage-agent

# View logs
sudo journalctl -u sysmanage-agent -f

# Restart service
sudo systemctl restart sysmanage-agent</code></pre>

                    <h3>macOS Service Management</h3>
                    <pre><code class="language-bash"># Load launch daemon
sudo launchctl load /Library/LaunchDaemons/com.sysmanage.agent.plist

# Start service
sudo launchctl start com.sysmanage.agent

# Check status
sudo launchctl list | grep sysmanage

# Stop service
sudo launchctl stop com.sysmanage.agent</code></pre>

                    <h3>Windows Service Management</h3>
                    <pre><code class="language-powershell"># Start service
Start-Service "SysManage Agent"

# Check service status
Get-Service "SysManage Agent"

# Set service to automatic startup
Set-Service "SysManage Agent" -StartupType Automatic

# View logs (Event Viewer or PowerShell)
Get-EventLog -LogName Application -Source "SysManage Agent" -Newest 10</code></pre>
                </section>

                <section class="verification">
                    <h2>6. Verification and Testing</h2>

                    <h3>Agent Status Verification</h3>
                    <p>Verify the agent is communicating properly with the server:</p>

                    <div class="verification-checklist">
                        <h4>Web Interface Checks</h4>
                        <ul>
                            <li>Agent appears in the Hosts list</li>
                            <li>Status shows as "Online" or "Connected"</li>
                            <li>System information is populated</li>
                            <li>Package inventory is available</li>
                            <li>Last contact time is recent</li>
                        </ul>

                        <h4>Command Line Checks</h4>
                        <pre><code class="language-bash"># Test agent connectivity
sysmanage-agent --status

# Test server communication
sysmanage-agent --ping-server

# View agent information
sysmanage-agent --info</code></pre>

                        <h4>Log File Checks</h4>
                        <pre><code class="language-bash"># Check for successful connection
grep "Successfully connected" /var/log/sysmanage-agent/agent.log

# Check for certificate issues
grep -i "certificate\|ssl\|tls" /var/log/sysmanage-agent/agent.log

# Check for communication errors
grep -i "error\|failed\|timeout" /var/log/sysmanage-agent/agent.log</code></pre>
                    </div>
                </section>

                <section class="bulk-deployment">
                    <h2>7. Bulk Agent Deployment</h2>

                    <h3>Ansible Deployment</h3>
                    <p>Example Ansible playbook for deploying agents:</p>
                    <pre><code class="language-yaml">---
- name: Deploy SysManage Agents
  hosts: all
  become: yes
  vars:
    sysmanage_server: "sysmanage.yourdomain.com"
    sysmanage_port: 8444

  tasks:
    - name: Download agent package
      get_url:
        url: "https://github.com/bceverly/sysmanage-agent/releases/latest/download/sysmanage-agent-linux-amd64.deb"
        dest: "/tmp/sysmanage-agent.deb"
      when: ansible_os_family == "Debian"

    - name: Install agent package
      apt:
        deb: "/tmp/sysmanage-agent.deb"
      when: ansible_os_family == "Debian"

    - name: Configure agent
      template:
        src: sysmanage-agent.yaml.j2
        dest: /etc/sysmanage-agent/sysmanage-agent.yaml
        mode: '0600'
      notify: restart sysmanage-agent

    - name: Start and enable agent service
      systemd:
        name: sysmanage-agent
        enabled: yes
        state: started

  handlers:
    - name: restart sysmanage-agent
      systemd:
        name: sysmanage-agent
        state: restarted</code></pre>

                    <h3>Configuration Template</h3>
                    <p>Ansible template (<code>sysmanage-agent.yaml.j2</code>):</p>
                    <pre><code class="language-yaml">server:
  host: "{{ sysmanage_server }}"
  port: {{ sysmanage_port }}
  ssl_enabled: true

agent:
  name: "{{ inventory_hostname }}"
  tags:
    - "{{ group_names | join('", "') }}"
  location: "{{ datacenter | default('unknown') }}"

packages:
  enabled: true
  auto_update_security: {{ auto_security_updates | default(false) }}

monitoring:
  enabled: true
  interval: 300</code></pre>
                </section>

                <section class="troubleshooting">
                    <h2>8. Troubleshooting</h2>

                    <h3>Common Issues</h3>
                    <div class="troubleshooting-grid">
                        <div class="issue-item">
                            <h4>Agent Not Connecting</h4>
                            <ul>
                                <li>Check network connectivity to server</li>
                                <li>Verify server hostname and port</li>
                                <li>Check firewall rules</li>
                                <li>Verify SSL certificate configuration</li>
                            </ul>
                        </div>
                        <div class="issue-item">
                            <h4>Certificate Issues</h4>
                            <ul>
                                <li>Check certificate file permissions</li>
                                <li>Verify certificate validity dates</li>
                                <li>Ensure CA certificate is correct</li>
                                <li>Check for certificate approval on server</li>
                            </ul>
                        </div>
                        <div class="issue-item">
                            <h4>Service Start Issues</h4>
                            <ul>
                                <li>Check configuration file syntax</li>
                                <li>Verify file permissions</li>
                                <li>Check system requirements</li>
                                <li>Review systemd logs</li>
                            </ul>
                        </div>
                        <div class="issue-item">
                            <h4>Performance Issues</h4>
                            <ul>
                                <li>Adjust monitoring interval</li>
                                <li>Check system resource usage</li>
                                <li>Review network latency</li>
                                <li>Optimize configuration settings</li>
                            </ul>
                        </div>
                    </div>

                    <h3>Diagnostic Commands</h3>
                    <pre><code class="language-bash"># Test network connectivity
telnet sysmanage.yourdomain.com 8444

# Test SSL connection
openssl s_client -connect sysmanage.yourdomain.com:8444

# Check certificate details
openssl x509 -in /etc/sysmanage-agent/certs/agent.crt -text -noout

# Test agent configuration
sysmanage-agent --config-test

# Enable debug logging
sysmanage-agent --log-level debug</code></pre>
                </section>

                <section class="security-considerations">
                    <h2>9. Security Considerations</h2>

                    <h3>Certificate Security</h3>
                    <ul>
                        <li>Protect private keys with proper file permissions (600)</li>
                        <li>Regular certificate rotation (automated)</li>
                        <li>Monitor for certificate expiration</li>
                        <li>Use strong cryptographic algorithms</li>
                    </ul>

                    <h3>Network Security</h3>
                    <ul>
                        <li>Use firewall rules to restrict agent communication</li>
                        <li>Monitor network traffic for anomalies</li>
                        <li>Consider network segmentation</li>
                        <li>Use VPN for remote agents if needed</li>
                    </ul>

                    <h3>Privileged Operations</h3>
                    <ul>
                        <li>Enable privileged mode only when necessary</li>
                        <li>Restrict allowed commands using whitelists</li>
                        <li>Audit privileged operations</li>
                        <li>Use sudo with specific command restrictions</li>
                    </ul>
                </section>

                <section class="next-steps">
                    <h2>Next Steps</h2>
                    <p>After successfully setting up your agents:</p>
                    <ol>
                        <li><strong><a href="basic-management.html">Learn basic management</a>:</strong> Master day-to-day operations</li>
                        <li><strong><a href="../administration/host-management.html">Host management</a>:</strong> Organize and manage your hosts</li>
                        <li><strong><a href="../administration/monitoring.html">Set up monitoring</a>:</strong> Configure alerts and monitoring</li>
                        <li><strong><a href="../agent/privileged-execution.html">Privileged operations</a>:</strong> Configure sudo access if needed</li>
                    </ol>
                </section>
            </div>

            <div class="docs-footer">
                <div class="docs-navigation">
                    <h3>Navigation</h3>
                    <div class="nav-links">
                        <a href="first-deployment.html" class="nav-link">← First Deployment</a>
                        <a href="basic-management.html" class="nav-link">Basic Management →</a>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <!-- Footer injected automatically by components.js -->    <script src="/assets/js/components.js"></script>
    <script src="/assets/js/i18n.js"></script>
    <script src="/assets/js/navbar.js"></script>
    <script src="/assets/js/main.js"></script>
</body>
</html>