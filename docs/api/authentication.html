<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication API - SysManage</title>
    <meta name="description" content="SysManage Authentication API documentation for JWT-based authentication and session management.">
    <link rel="stylesheet" href="../../assets/css/style.css">
    <link rel="icon" type="image/svg+xml" href="../../assets/images/favicon.svg">
</head>
<body>
    <header class="site-header">
        <nav class="navbar">
            <div class="container">
                <div class="nav-brand">
                    <a href="../../">
                        <img src="../../assets/images/sysmanage-logo.svg" alt="SysManage" class="logo">
                    </a>
                </div>
                <div class="nav-menu">
                    <a href="../../#features" class="nav-link" data-i18n="nav.features" data-i18n-html>Features</a>
                    <a href="../../#getting-started" class="nav-link" data-i18n="nav.getting_started" data-i18n-html>Getting Started</a>
                    <a href="../" class="nav-link active" data-i18n="nav.documentation" data-i18n-html>Documentation</a>
                    <a href="../../config-builder.html" class="nav-link" data-i18n="nav.config_builder" data-i18n-html>Configuration Builder</a>
                    <a href="https://github.com/bceverly/sysmanage" class="nav-link" target="_blank" data-i18n="nav.github" data-i18n-html>GitHub</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="docs-main">
        <div class="container">
            <div class="docs-breadcrumb">
                <a href="../">Documentation</a> > <a href="./">API Reference</a> > <span>Authentication</span>
            </div>

            <div class="docs-header">
                <h1>Authentication API</h1>
                <p>JWT-based authentication system for secure access to SysManage APIs with token refresh and session management.</p>
            </div>

            <div class="docs-content">
                <section class="overview">
                    <h2>Overview</h2>
                    <p>SysManage uses JSON Web Tokens (JWT) for authentication. All API endpoints (except authentication endpoints) require a valid JWT token in the Authorization header.</p>

                    <div class="auth-flow">
                        <h3>Authentication Flow</h3>
                        <ol>
                            <li>Send username and password to <code>/api/v1/auth/login</code></li>
                            <li>Receive access token and refresh token</li>
                            <li>Include access token in Authorization header for API requests</li>
                            <li>Use refresh token to get new access token when expired</li>
                        </ol>
                    </div>
                </section>

                <section class="endpoint-section">
                    <h2>Login</h2>
                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <code>/api/v1/auth/login</code>
                        </div>

                        <p>Authenticate user credentials and receive JWT tokens for API access.</p>

                        <h4>Request Body</h4>
                        <div class="code-block">
                            <pre><code>{
  "username": "string",
  "password": "string"
}</code></pre>
                        </div>

                        <h4>Response (200 OK)</h4>
                        <div class="code-block">
                            <pre><code>{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "refresh_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "token_type": "bearer",
  "expires_in": 3600,
  "user": {
    "id": "uuid",
    "username": "string",
    "email": "string",
    "is_admin": false,
    "created_at": "2024-01-01T00:00:00Z",
    "last_login": "2024-01-01T00:00:00Z"
  }
}</code></pre>
                        </div>

                        <h4>Error Responses</h4>
                        <div class="error-responses">
                            <div class="error-response">
                                <strong>401 Unauthorized</strong> - Invalid credentials
                                <div class="code-block">
                                    <pre><code>{
  "detail": "Invalid credentials"
}</code></pre>
                                </div>
                            </div>
                            <div class="error-response">
                                <strong>429 Too Many Requests</strong> - Rate limit exceeded
                                <div class="code-block">
                                    <pre><code>{
  "detail": "Too many login attempts. Please try again later."
}</code></pre>
                                </div>
                            </div>
                        </div>

                        <h4>Example</h4>
                        <div class="code-block">
                            <pre><code>curl -X POST "https://your-server.example.com/api/v1/auth/login" \
     -H "Content-Type: application/json" \
     -d '{
       "username": "admin",
       "password": "secure-password"
     }'</code></pre>
                        </div>
                    </div>
                </section>

                <section class="endpoint-section">
                    <h2>Refresh Token</h2>
                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <code>/api/v1/auth/refresh</code>
                        </div>

                        <p>Exchange a valid refresh token for a new access token when the current one expires.</p>

                        <h4>Request Body</h4>
                        <div class="code-block">
                            <pre><code>{
  "refresh_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
}</code></pre>
                        </div>

                        <h4>Response (200 OK)</h4>
                        <div class="code-block">
                            <pre><code>{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "token_type": "bearer",
  "expires_in": 3600
}</code></pre>
                        </div>

                        <h4>Error Responses</h4>
                        <div class="error-responses">
                            <div class="error-response">
                                <strong>401 Unauthorized</strong> - Invalid or expired refresh token
                                <div class="code-block">
                                    <pre><code>{
  "detail": "Invalid refresh token"
}</code></pre>
                                </div>
                            </div>
                        </div>

                        <h4>Example</h4>
                        <div class="code-block">
                            <pre><code>curl -X POST "https://your-server.example.com/api/v1/auth/refresh" \
     -H "Content-Type: application/json" \
     -d '{
       "refresh_token": "your-refresh-token"
     }'</code></pre>
                        </div>
                    </div>
                </section>

                <section class="endpoint-section">
                    <h2>Password Reset</h2>
                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <code>/api/v1/auth/forgot-password</code>
                        </div>

                        <p>Request a password reset email for user account recovery.</p>

                        <h4>Request Body</h4>
                        <div class="code-block">
                            <pre><code>{
  "email": "user@example.com"
}</code></pre>
                        </div>

                        <h4>Response (200 OK)</h4>
                        <div class="code-block">
                            <pre><code>{
  "message": "Password reset email sent successfully"
}</code></pre>
                        </div>

                        <h4>Example</h4>
                        <div class="code-block">
                            <pre><code>curl -X POST "https://your-server.example.com/api/v1/auth/forgot-password" \
     -H "Content-Type: application/json" \
     -d '{
       "email": "user@example.com"
     }'</code></pre>
                        </div>
                    </div>
                </section>

                <section class="endpoint-section">
                    <h2>Reset Password</h2>
                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <code>/api/v1/auth/reset-password</code>
                        </div>

                        <p>Reset user password using a valid reset token received via email.</p>

                        <h4>Request Body</h4>
                        <div class="code-block">
                            <pre><code>{
  "token": "reset-token-from-email",
  "new_password": "new-secure-password"
}</code></pre>
                        </div>

                        <h4>Response (200 OK)</h4>
                        <div class="code-block">
                            <pre><code>{
  "message": "Password reset successfully"
}</code></pre>
                        </div>

                        <h4>Error Responses</h4>
                        <div class="error-responses">
                            <div class="error-response">
                                <strong>400 Bad Request</strong> - Invalid or expired reset token
                                <div class="code-block">
                                    <pre><code>{
  "detail": "Invalid or expired reset token"
}</code></pre>
                                </div>
                            </div>
                        </div>

                        <h4>Example</h4>
                        <div class="code-block">
                            <pre><code>curl -X POST "https://your-server.example.com/api/v1/auth/reset-password" \
     -H "Content-Type: application/json" \
     -d '{
       "token": "reset-token-from-email",
       "new_password": "new-secure-password"
     }'</code></pre>
                        </div>
                    </div>
                </section>

                <section class="endpoint-section">
                    <h2>Validate Reset Token</h2>
                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <code>/api/v1/auth/validate-reset-token/{token}</code>
                        </div>

                        <p>Validate if a password reset token is still valid and not expired.</p>

                        <h4>Path Parameters</h4>
                        <ul>
                            <li><code>token</code> (string) - The reset token to validate</li>
                        </ul>

                        <h4>Response (200 OK)</h4>
                        <div class="code-block">
                            <pre><code>{
  "valid": true,
  "expires_at": "2024-01-01T01:00:00Z"
}</code></pre>
                        </div>

                        <h4>Error Responses</h4>
                        <div class="error-responses">
                            <div class="error-response">
                                <strong>400 Bad Request</strong> - Invalid or expired token
                                <div class="code-block">
                                    <pre><code>{
  "valid": false,
  "detail": "Token expired or invalid"
}</code></pre>
                                </div>
                            </div>
                        </div>

                        <h4>Example</h4>
                        <div class="code-block">
                            <pre><code>curl -X GET "https://your-server.example.com/api/v1/auth/validate-reset-token/abc123"</code></pre>
                        </div>
                    </div>
                </section>

                <section class="auth-usage">
                    <h2>Using Authentication Tokens</h2>
                    <p>Once you receive an access token from the login endpoint, include it in the Authorization header of all API requests:</p>

                    <div class="code-block">
                        <pre><code>Authorization: Bearer YOUR_ACCESS_TOKEN</code></pre>
                    </div>

                    <h3>Token Expiration</h3>
                    <p>Access tokens expire after 1 hour (3600 seconds). When an access token expires, use the refresh token to obtain a new one without requiring the user to log in again.</p>

                    <h3>Security Best Practices</h3>
                    <ul>
                        <li>Store tokens securely and never expose them in client-side code</li>
                        <li>Implement automatic token refresh before expiration</li>
                        <li>Use HTTPS for all authentication requests</li>
                        <li>Implement proper logout functionality to invalidate tokens</li>
                        <li>Monitor for unusual authentication patterns</li>
                    </ul>
                </section>
            </div>

            <div class="docs-footer">
                <div class="docs-navigation">
                    <h3>Quick Navigation</h3>
                    <div class="nav-links">
                        <a href="./" class="nav-link">← API Reference</a>
                        <a href="hosts.html" class="nav-link">Host Management →</a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2024 SysManage. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="../../assets/js/main.js"></script>
    <script src="../../assets/js/i18n.js"></script>
    <script src="../../assets/js/navbar.js"></script>
    <script src="../../assets/js/main.js"></script>
    <script src="../../assets/js/i18n.js"></script>
</body>
</html>