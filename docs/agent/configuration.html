<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Configuration - SysManage</title>
    <meta name="description" content="Complete guide to configuring SysManage agents including server connection, security, and data collection settings.">
    <link rel="stylesheet" href="../../assets/css/style.css">
    <link rel="icon" type="image/svg+xml" href="../../assets/images/favicon.svg">
</head>
<body>
    <header class="site-header">
        <nav class="navbar">
            <div class="container">
                <div class="nav-brand">
                    <a href="../../">
                        <img src="../../assets/images/sysmanage-logo.svg" alt="SysManage" class="logo">
                    </a>
                </div>
                <div class="nav-menu">
                    <a href="../../#features" class="nav-link" data-i18n="nav.features" data-i18n-html>Features</a>
                    <a href="../../#getting-started" class="nav-link" data-i18n="nav.getting_started" data-i18n-html>Getting Started</a>
                    <a href="../" class="nav-link active" data-i18n="nav.documentation" data-i18n-html>Documentation</a>
                    <a href="../../config-builder.html" class="nav-link" data-i18n="nav.config_builder" data-i18n-html>Configuration Builder</a>
                    <a href="https://github.com/bceverly/sysmanage" class="nav-link" target="_blank" data-i18n="nav.github" data-i18n-html>GitHub</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="docs-main">
        <div class="container">
            <div class="docs-breadcrumb">
                <a href="../">Documentation</a> > <a href="./">Agent</a> > <span>Configuration</span>
            </div>

            <div class="docs-header">
                <h1>Agent Configuration</h1>
                <p>Complete guide to configuring SysManage agents including server connection, security settings, and data collection options.</p>
            </div>

            <div class="docs-content">
                <section class="overview">
                    <h2>Overview</h2>
                    <p>The SysManage agent is configured through a YAML configuration file named <code>sysmanage-agent.yaml</code>. This file controls all aspects of agent behavior including server connectivity, security settings, data collection intervals, and script execution policies.</p>

                    <div class="config-file-location">
                        <h3>Configuration File Location</h3>
                        <ul>
                            <li><strong>Linux/Unix:</strong> <code>/etc/sysmanage-agent/sysmanage-agent.yaml</code></li>
                            <li><strong>Current Directory:</strong> <code>./sysmanage-agent.yaml</code></li>
                            <li><strong>User Config:</strong> <code>~/.config/sysmanage-agent/sysmanage-agent.yaml</code></li>
                        </ul>
                        <p>The agent searches for configuration files in the order listed above.</p>
                    </div>
                </section>

                <section class="config-section">
                    <h2>Server Connection Settings</h2>
                    <p>Configure how the agent connects to the SysManage server.</p>

                    <div class="config-example">
                        <h3>Basic Server Configuration</h3>
                        <div class="code-block">
                            <pre><code>server:
  # Hostname or IP address of the SysManage server
  hostname: "sysmanage.example.com"

  # Port number for the SysManage server
  port: 8080

  # Use HTTPS for secure communication
  use_https: true

  # Verify SSL certificates (recommended in production)
  verify_ssl: true</code></pre>
                        </div>
                    </div>

                    <div class="config-options">
                        <h3>Server Options</h3>
                        <table class="config-table">
                            <thead>
                                <tr>
                                    <th>Option</th>
                                    <th>Type</th>
                                    <th>Default</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>hostname</code></td>
                                    <td>string</td>
                                    <td>"localhost"</td>
                                    <td>Server hostname or IP address</td>
                                </tr>
                                <tr>
                                    <td><code>port</code></td>
                                    <td>integer</td>
                                    <td>8080</td>
                                    <td>Server port number</td>
                                </tr>
                                <tr>
                                    <td><code>use_https</code></td>
                                    <td>boolean</td>
                                    <td>false</td>
                                    <td>Enable HTTPS for secure communication</td>
                                </tr>
                                <tr>
                                    <td><code>verify_ssl</code></td>
                                    <td>boolean</td>
                                    <td>false</td>
                                    <td>Verify SSL certificates</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <section class="config-section">
                    <h2>Client Identification</h2>
                    <p>Configure agent identification and registration behavior.</p>

                    <div class="config-example">
                        <div class="code-block">
                            <pre><code>client:
  # Optional: Override the system hostname detection
  # If not specified, the agent will auto-detect the system hostname
  # hostname_override: "my-custom-hostname"

  # Registration retry settings
  registration_retry_interval: 30  # seconds between registration attempts
  max_registration_retries: 10     # maximum number of retry attempts (-1 for infinite)

  # Update check settings
  update_check_interval: 3600      # seconds between update checks (default: 1 hour)

  # Package collection settings
  package_collection_interval: 86400  # seconds between package collection runs (default: 24 hours)
  package_collection_enabled: true    # enable/disable automatic package collection
  package_collection_at_startup: true # collect packages at agent startup</code></pre>
                        </div>
                    </div>

                    <div class="config-options">
                        <h3>Client Options</h3>
                        <table class="config-table">
                            <thead>
                                <tr>
                                    <th>Option</th>
                                    <th>Type</th>
                                    <th>Default</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>hostname_override</code></td>
                                    <td>string</td>
                                    <td>auto-detected</td>
                                    <td>Override system hostname for identification</td>
                                </tr>
                                <tr>
                                    <td><code>registration_retry_interval</code></td>
                                    <td>integer</td>
                                    <td>30</td>
                                    <td>Seconds between registration retry attempts</td>
                                </tr>
                                <tr>
                                    <td><code>max_registration_retries</code></td>
                                    <td>integer</td>
                                    <td>10</td>
                                    <td>Maximum registration retries (-1 for infinite)</td>
                                </tr>
                                <tr>
                                    <td><code>update_check_interval</code></td>
                                    <td>integer</td>
                                    <td>3600</td>
                                    <td>Seconds between update availability checks</td>
                                </tr>
                                <tr>
                                    <td><code>package_collection_interval</code></td>
                                    <td>integer</td>
                                    <td>86400</td>
                                    <td>Seconds between package inventory collection</td>
                                </tr>
                                <tr>
                                    <td><code>package_collection_enabled</code></td>
                                    <td>boolean</td>
                                    <td>true</td>
                                    <td>Enable automatic package collection</td>
                                </tr>
                                <tr>
                                    <td><code>package_collection_at_startup</code></td>
                                    <td>boolean</td>
                                    <td>true</td>
                                    <td>Collect packages during agent startup</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <section class="config-section">
                    <h2>Internationalization</h2>
                    <p>Configure language settings for agent messages and logging.</p>

                    <div class="config-example">
                        <div class="code-block">
                            <pre><code>i18n:
  # Language/locale for agent messages and logging
  # Supported languages: en, es, fr, de, it, pt, nl, ja, zh_CN, ko, ru
  language: "en"</code></pre>
                        </div>
                    </div>

                    <div class="supported-languages">
                        <h3>Supported Languages</h3>
                        <ul>
                            <li><code>en</code> - English (default)</li>
                            <li><code>es</code> - Spanish</li>
                            <li><code>fr</code> - French</li>
                            <li><code>de</code> - German</li>
                            <li><code>it</code> - Italian</li>
                            <li><code>pt</code> - Portuguese</li>
                            <li><code>nl</code> - Dutch</li>
                            <li><code>ja</code> - Japanese</li>
                            <li><code>zh_CN</code> - Chinese (Simplified)</li>
                            <li><code>ko</code> - Korean</li>
                            <li><code>ru</code> - Russian</li>
                        </ul>
                    </div>
                </section>

                <section class="config-section">
                    <h2>Logging Configuration</h2>
                    <p>Control agent logging behavior and output format.</p>

                    <div class="config-example">
                        <div class="code-block">
                            <pre><code>logging:
  # Log levels to include: DEBUG, INFO, WARNING, ERROR, CRITICAL
  # Can combine multiple levels with pipe: "INFO|WARNING|ERROR|CRITICAL"
  # Examples: "DEBUG" (debug only), "INFO|ERROR" (info and errors only)
  level: "INFO|WARNING|ERROR|CRITICAL"

  # Log to file (default is logs/* in service directory)
  # file: "/var/log/sysmanage-agent.log"

  # Log format - customize the log message appearance
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"</code></pre>
                        </div>
                    </div>

                    <div class="logging-levels">
                        <h3>Log Levels</h3>
                        <ul>
                            <li><code>DEBUG</code> - Detailed diagnostic information</li>
                            <li><code>INFO</code> - General operational information</li>
                            <li><code>WARNING</code> - Warning messages for unusual conditions</li>
                            <li><code>ERROR</code> - Error messages for serious problems</li>
                            <li><code>CRITICAL</code> - Critical error messages</li>
                        </ul>
                    </div>
                </section>

                <section class="config-section">
                    <h2>WebSocket Configuration</h2>
                    <p>Configure real-time communication settings with the server.</p>

                    <div class="config-example">
                        <div class="code-block">
                            <pre><code>websocket:
  # Auto-reconnect on connection loss
  auto_reconnect: true

  # Reconnection interval in seconds
  reconnect_interval: 5

  # Ping interval to keep connection alive
  ping_interval: 60</code></pre>
                        </div>
                    </div>

                    <div class="config-options">
                        <h3>WebSocket Options</h3>
                        <table class="config-table">
                            <thead>
                                <tr>
                                    <th>Option</th>
                                    <th>Type</th>
                                    <th>Default</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>auto_reconnect</code></td>
                                    <td>boolean</td>
                                    <td>true</td>
                                    <td>Automatically reconnect on connection loss</td>
                                </tr>
                                <tr>
                                    <td><code>reconnect_interval</code></td>
                                    <td>integer</td>
                                    <td>5</td>
                                    <td>Seconds to wait before reconnection attempt</td>
                                </tr>
                                <tr>
                                    <td><code>ping_interval</code></td>
                                    <td>integer</td>
                                    <td>60</td>
                                    <td>Seconds between ping messages to keep connection alive</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <section class="config-section">
                    <h2>Database Configuration</h2>
                    <p>Configure the agent's local SQLite database settings.</p>

                    <div class="config-example">
                        <div class="code-block">
                            <pre><code>database:
  # Path to the agent's SQLite database file
  # If not specified, defaults to "agent.db" in the agent's working directory
  path: "agent.db"

  # Whether to automatically run database migrations on startup
  auto_migrate: true</code></pre>
                        </div>
                    </div>
                </section>

                <section class="config-section">
                    <h2>Message Queue Configuration</h2>
                    <p>Configure message handling and cleanup behavior.</p>

                    <div class="config-example">
                        <div class="code-block">
                            <pre><code>message_queue:
  # Message expiration timeout in minutes (default: 60)
  # Messages older than this will be marked as expired and no longer processed
  expiration_timeout_minutes: 60

  # Cleanup interval in minutes (default: 30)
  # How often to check for and clean up expired messages
  cleanup_interval_minutes: 30</code></pre>
                        </div>
                    </div>
                </section>

                <section class="config-section">
                    <h2>Script Execution Configuration</h2>
                    <p>Configure security settings for remote script execution.</p>
                    <div class="security-warning">
                        <strong>⚠️ Security Notice:</strong> Script execution is a powerful feature that requires careful configuration. Only enable if you trust the server administrators and understand the security implications.
                    </div>

                    <div class="config-example">
                        <div class="code-block">
                            <pre><code>script_execution:
  # Enable or disable script execution functionality
  # Setting this to false completely disables script execution
  enabled: false

  # Maximum script execution timeout in seconds (default: 300 = 5 minutes)
  # Scripts that run longer than this will be terminated
  timeout: 300

  # Maximum number of concurrent script executions allowed
  # This prevents resource exhaustion from multiple simultaneous scripts
  max_concurrent: 3

  # Allowed shells for script execution
  # Only these shells will be permitted for script execution
  allowed_shells:
    - "bash"        # Default shell on most Linux systems
    - "sh"          # POSIX shell
    - "zsh"         # macOS default shell and popular Linux shell

  # User execution restrictions (only applies when agent runs as root)
  user_restrictions:
    # Allow script execution as different users (requires agent to run as root)
    allow_user_switching: false

    # List of users that scripts are allowed to run as
    # Empty list means any user is allowed (if allow_user_switching is true)
    allowed_users: []

  # Security restrictions
  security:
    # Prevent scripts from accessing sensitive files/directories
    # This is advisory - actual enforcement depends on user permissions
    restricted_paths:
      - "/etc/passwd"
      - "/etc/shadow"
      - "/etc/ssh/"
      - "/home/*/.ssh/"
      - "/root/.ssh/"
      - "*.key"
      - "*.pem"

    # Log all script executions for audit purposes
    audit_logging: true

    # Require explicit approval for each script execution
    # If true, scripts will be queued for manual approval
    require_approval: false</code></pre>
                        </div>
                    </div>

                    <div class="security-best-practices">
                        <h3>Security Best Practices</h3>
                        <ul>
                            <li>Keep script execution disabled unless absolutely necessary</li>
                            <li>Enable audit logging for compliance and security monitoring</li>
                            <li>Restrict allowed shells to only those you need</li>
                            <li>Use user restrictions to limit privilege escalation</li>
                            <li>Enable approval requirements for sensitive environments</li>
                            <li>Regularly review script execution logs</li>
                        </ul>
                    </div>
                </section>

                <section class="config-section">
                    <h2>Data Collection Configuration</h2>
                    <p>Configure what system information the agent collects and how frequently.</p>

                    <div class="config-example">
                        <div class="code-block">
                            <pre><code>collection:
  # Enable collection of system information
  enabled: true

  # Collection intervals (in seconds)
  intervals:
    system_info: 300      # 5 minutes
    software: 3600        # 1 hour
    hardware: 1800        # 30 minutes
    network: 300          # 5 minutes
    users: 1800           # 30 minutes
    available_packages: 86400  # 24 hours (daily collection of available packages)

  # Types of data to collect
  types:
    software_packages: true
    system_updates: true
    hardware_info: true
    network_interfaces: true
    user_accounts: true
    system_metrics: true
    available_packages: true  # Collect available packages from package managers</code></pre>
                        </div>
                    </div>

                    <div class="collection-types">
                        <h3>Collection Types</h3>
                        <table class="config-table">
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>Description</th>
                                    <th>Default Interval</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>software_packages</code></td>
                                    <td>Installed software packages and versions</td>
                                    <td>1 hour</td>
                                </tr>
                                <tr>
                                    <td><code>system_updates</code></td>
                                    <td>Available system updates and security patches</td>
                                    <td>1 hour</td>
                                </tr>
                                <tr>
                                    <td><code>hardware_info</code></td>
                                    <td>CPU, memory, storage, and other hardware details</td>
                                    <td>30 minutes</td>
                                </tr>
                                <tr>
                                    <td><code>network_interfaces</code></td>
                                    <td>Network interface configuration and statistics</td>
                                    <td>5 minutes</td>
                                </tr>
                                <tr>
                                    <td><code>user_accounts</code></td>
                                    <td>System user accounts and group memberships</td>
                                    <td>30 minutes</td>
                                </tr>
                                <tr>
                                    <td><code>system_metrics</code></td>
                                    <td>CPU usage, memory usage, disk space, load average</td>
                                    <td>5 minutes</td>
                                </tr>
                                <tr>
                                    <td><code>available_packages</code></td>
                                    <td>Packages available from configured repositories</td>
                                    <td>24 hours</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <section class="config-examples">
                    <h2>Configuration Examples</h2>

                    <div class="example">
                        <h3>Production Environment</h3>
                        <div class="code-block">
                            <pre><code>server:
  hostname: "sysmanage.company.com"
  port: 443
  use_https: true
  verify_ssl: true

client:
  registration_retry_interval: 60
  max_registration_retries: 5
  update_check_interval: 7200  # Check every 2 hours

i18n:
  language: "en"

logging:
  level: "WARNING|ERROR|CRITICAL"
  file: "/var/log/sysmanage-agent.log"

script_execution:
  enabled: false  # Disabled for security

collection:
  enabled: true
  intervals:
    system_info: 600      # 10 minutes
    software: 7200        # 2 hours
    hardware: 3600        # 1 hour</code></pre>
                        </div>
                    </div>

                    <div class="example">
                        <h3>Development Environment</h3>
                        <div class="code-block">
                            <pre><code>server:
  hostname: "localhost"
  port: 8080
  use_https: false
  verify_ssl: false

client:
  registration_retry_interval: 10
  max_registration_retries: -1  # Infinite retries
  update_check_interval: 300    # Check every 5 minutes

logging:
  level: "DEBUG"
  format: "%(asctime)s [%(levelname)s] %(message)s"

script_execution:
  enabled: true
  timeout: 600
  security:
    audit_logging: true
    require_approval: true

collection:
  intervals:
    system_info: 60       # 1 minute for rapid testing
    software: 300         # 5 minutes</code></pre>
                        </div>
                    </div>
                </section>

                <section class="validation">
                    <h2>Configuration Validation</h2>
                    <p>The agent validates configuration on startup and reports any issues in the logs.</p>

                    <div class="validation-tips">
                        <h3>Common Validation Issues</h3>
                        <ul>
                            <li><strong>Invalid YAML syntax:</strong> Check indentation and structure</li>
                            <li><strong>Unknown configuration keys:</strong> Verify spelling and supported options</li>
                            <li><strong>Invalid data types:</strong> Ensure boolean values are true/false, integers are numeric</li>
                            <li><strong>Out-of-range values:</strong> Check minimum/maximum values for timeouts and intervals</li>
                            <li><strong>Missing required fields:</strong> Some sections require certain keys to be present</li>
                        </ul>
                    </div>

                    <div class="validation-command">
                        <h3>Test Configuration</h3>
                        <p>Test your configuration before deploying:</p>
                        <div class="code-block">
                            <pre><code># Test configuration syntax
sysmanage-agent --config-test

# Run agent with verbose logging to check configuration
sysmanage-agent --verbose</code></pre>
                        </div>
                    </div>
                </section>
            </div>

            <div class="docs-footer">
                <div class="docs-navigation">
                    <h3>Quick Navigation</h3>
                    <div class="nav-links">
                        <a href="installation.html" class="nav-link">← Installation</a>
                        <a href="privileged-execution.html" class="nav-link">Privileged Execution →</a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2024 SysManage. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="../../assets/js/navbar.js"></script>
    <script src="../../assets/js/main.js"></script>
    <script src="../../assets/js/i18n.js"></script>
</body>
</html>