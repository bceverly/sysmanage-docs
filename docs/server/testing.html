<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testing - SysManage Server</title>
    <meta name="description" content="Comprehensive testing guide for SysManage including unit tests, integration tests, and E2E testing with Playwright.">
    <link rel="stylesheet" href="../../assets/css/style.css">
    <link rel="icon" type="image/svg+xml" href="../../assets/images/favicon.svg">
</head>
<body>
    <header class="site-header">
        <nav class="navbar">
            <div class="container">
                <div class="nav-brand">
                    <a href="../../">
                        <img src="../../assets/images/sysmanage-logo.svg" alt="SysManage" class="logo">
                    </a>
                </div>
                <div class="nav-menu">
                    <a href="../../#features" class="nav-link">Features</a>
                    <a href="../../#getting-started" class="nav-link">Getting Started</a>
                    <a href="../" class="nav-link active">Documentation</a>
                    <a href="https://github.com/bceverly/sysmanage" class="nav-link" target="_blank">GitHub</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="docs-main">
        <div class="container">
            <div class="docs-breadcrumb">
                <a href="../">Documentation</a> > <a href="./">Server</a> > <span>Testing</span>
            </div>

            <div class="docs-header">
                <h1>Testing</h1>
                <p>Comprehensive testing strategy for SysManage server including unit tests, integration tests, and end-to-end testing with Playwright.</p>
            </div>

            <div class="docs-content">
                <section class="docs-overview">
                    <h2>Testing Strategy Overview</h2>
                    <p>SysManage employs a multi-layered testing approach to ensure reliability, security, and functionality across all components:</p>

                    <div class="testing-layers">
                        <div class="testing-layer">
                            <h3>ðŸ§ª Unit Tests</h3>
                            <p>Comprehensive unit testing for individual components and functions</p>
                            <ul>
                                <li><strong>Backend:</strong> 1,432 Python tests using pytest</li>
                                <li><strong>Frontend:</strong> 63 TypeScript tests using Vitest</li>
                                <li><strong>Coverage:</strong> 100% test coverage for both backend and frontend</li>
                            </ul>
                        </div>
                        <div class="testing-layer">
                            <h3>ðŸ”— Integration Tests</h3>
                            <p>Testing interactions between different system components</p>
                            <ul>
                                <li>API endpoint testing</li>
                                <li>Database integration testing</li>
                                <li>WebSocket communication testing</li>
                                <li>Authentication and authorization flow testing</li>
                            </ul>
                        </div>
                        <div class="testing-layer">
                            <h3>ðŸŽ­ End-to-End (E2E) Tests</h3>
                            <p>Complete user workflow testing using Playwright</p>
                            <ul>
                                <li>Full user journey testing</li>
                                <li>Cross-browser compatibility</li>
                                <li>Real-world scenario validation</li>
                                <li>UI interaction and workflow testing</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <section class="docs-section">
                    <h2>Running Tests</h2>

                    <h3>All Tests</h3>
                    <div class="code-block">
                        <pre><code># Run complete test suite
make test

# Run tests with coverage reporting
make test-coverage</code></pre>
                    </div>

                    <h3>Backend Tests (Python/pytest)</h3>
                    <div class="code-block">
                        <pre><code># Run all backend tests
python -m pytest tests/ -v

# Run specific test file
python -m pytest tests/test_api_hosts.py -v

# Run with coverage
python -m pytest tests/ --cov=backend --cov-report=html

# Run only unit tests
python -m pytest tests/ -m "not integration"

# Run only integration tests
python -m pytest tests/ -m integration</code></pre>
                    </div>

                    <h3>Frontend Tests (TypeScript/Vitest)</h3>
                    <div class="code-block">
                        <pre><code># Run all frontend tests
cd frontend && npm test

# Run tests in watch mode
cd frontend && npm run test:watch

# Run with coverage
cd frontend && npm run test:coverage

# Run specific test file
cd frontend && npm test -- src/__tests__/Pages/Reports.test.tsx</code></pre>
                    </div>

                    <h3>End-to-End Tests (Playwright)</h3>
                    <div class="code-block">
                        <pre><code># Install Playwright (if not already installed)
pip install playwright
npx playwright install

# Run E2E tests
npm run test:e2e

# Run E2E tests in specific browser
npx playwright test --project=chromium
npx playwright test --project=firefox
npx playwright test --project=webkit

# Run E2E tests in headed mode (visible browser)
npx playwright test --headed

# Debug E2E tests
npx playwright test --debug</code></pre>
                    </div>
                </section>

                <section class="docs-section">
                    <h2>Playwright E2E Testing</h2>

                    <h3>Overview</h3>
                    <p>Playwright provides comprehensive end-to-end testing capabilities for SysManage, allowing you to test complete user workflows across different browsers and platforms.</p>

                    <h3>Installation & Setup</h3>
                    <div class="code-block">
                        <pre><code># Install Playwright
npm install -D @playwright/test

# Install browser binaries
npx playwright install

# Install system dependencies (Linux)
npx playwright install-deps</code></pre>
                    </div>

                    <div class="info-box">
                        <h4>ðŸ’¡ Platform Compatibility</h4>
                        <p>Playwright may not be available on all platforms. For example, it's currently not supported on OpenBSD. In such cases, manual testing or alternative tools should be used.</p>
                    </div>

                    <h3>Configuration</h3>
                    <p>Playwright configuration is defined in <code>playwright.config.ts</code>:</p>
                    <div class="code-block">
                        <pre><code>import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',
  use: {
    baseURL: 'http://localhost:3000',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
  },
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
    {
      name: 'firefox',
      use: { ...devices['Desktop Firefox'] },
    },
    {
      name: 'webkit',
      use: { ...devices['Desktop Safari'] },
    },
  ],
  webServer: {
    command: 'npm run start',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
  },
});</code></pre>
                    </div>

                    <h3>Example E2E Test</h3>
                    <div class="code-block">
                        <pre><code>// e2e/login-workflow.spec.ts
import { test, expect } from '@playwright/test';

test('user can login and access dashboard', async ({ page }) => {
  // Navigate to login page
  await page.goto('/login');

  // Fill login form
  await page.fill('[data-testid=username]', 'admin@example.com');
  await page.fill('[data-testid=password]', 'password123');

  // Submit form
  await page.click('[data-testid=login-button]');

  // Verify successful login
  await expect(page).toHaveURL('/dashboard');
  await expect(page.locator('h1')).toContainText('Dashboard');
});

test('user can generate reports', async ({ page }) => {
  // Login first
  await page.goto('/login');
  await page.fill('[data-testid=username]', 'admin@example.com');
  await page.fill('[data-testid=password]', 'password123');
  await page.click('[data-testid=login-button]');

  // Navigate to reports
  await page.click('text=Reports');
  await expect(page).toHaveURL('/reports');

  // Generate PDF report
  await page.click('text=Generate PDF');

  // Wait for download
  const downloadPromise = page.waitForEvent('download');
  const download = await downloadPromise;

  // Verify download
  expect(download.suggestedFilename()).toContain('.pdf');
});</code></pre>
                    </div>

                    <h3>Best Practices</h3>
                    <ul>
                        <li><strong>Data Attributes:</strong> Use <code>data-testid</code> attributes for reliable element selection</li>
                        <li><strong>Page Object Model:</strong> Organize tests using page objects for maintainability</li>
                        <li><strong>Test Isolation:</strong> Ensure tests are independent and can run in any order</li>
                        <li><strong>Wait Strategies:</strong> Use appropriate wait strategies for dynamic content</li>
                        <li><strong>Screenshots:</strong> Enable screenshots on failure for debugging</li>
                        <li><strong>Cross-browser:</strong> Run tests across multiple browsers to ensure compatibility</li>
                    </ul>
                </section>

                <section class="docs-section">
                    <h2>Test Coverage</h2>

                    <h3>Coverage Reports</h3>
                    <p>SysManage maintains comprehensive test coverage across all layers:</p>

                    <div class="coverage-stats">
                        <div class="coverage-item">
                            <h4>Backend Coverage</h4>
                            <div class="coverage-bar">
                                <div class="coverage-fill" style="width: 100%;">100%</div>
                            </div>
                            <p>1,432 Python tests covering API endpoints, business logic, and database operations</p>
                        </div>
                        <div class="coverage-item">
                            <h4>Frontend Coverage</h4>
                            <div class="coverage-bar">
                                <div class="coverage-fill" style="width: 100%;">100%</div>
                            </div>
                            <p>63 TypeScript tests covering React components, services, and utilities</p>
                        </div>
                    </div>

                    <h3>Generating Coverage Reports</h3>
                    <div class="code-block">
                        <pre><code># Backend coverage (HTML report)
python -m pytest tests/ --cov=backend --cov-report=html
open htmlcov/index.html

# Frontend coverage
cd frontend && npm run test:coverage
open coverage/index.html

# Combined coverage reporting
make test-coverage</code></pre>
                    </div>
                </section>

                <section class="docs-section">
                    <h2>Continuous Integration</h2>

                    <h3>GitHub Actions</h3>
                    <p>All tests run automatically in the CI/CD pipeline:</p>
                    <div class="code-block">
                        <pre><code>name: CI/CD Pipeline
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'

      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          cd frontend && npm install

      - name: Run backend tests
        run: python -m pytest tests/ --cov=backend

      - name: Run frontend tests
        run: cd frontend && npm test

      - name: Install Playwright
        run: npx playwright install --with-deps

      - name: Run E2E tests
        run: npm run test:e2e</code></pre>
                    </div>
                </section>

                <section class="docs-section">
                    <h2>Testing Different Components</h2>

                    <h3>API Endpoints</h3>
                    <p>Test API endpoints using pytest with FastAPI's test client:</p>
                    <div class="code-block">
                        <pre><code>def test_get_hosts(authenticated_client):
    response = authenticated_client.get("/api/hosts")
    assert response.status_code == 200
    assert "hosts" in response.json()

def test_create_host(authenticated_client):
    host_data = {
        "fqdn": "test.example.com",
        "active": True
    }
    response = authenticated_client.post("/api/hosts", json=host_data)
    assert response.status_code == 201</code></pre>
                    </div>

                    <h3>React Components</h3>
                    <p>Test React components using Vitest and React Testing Library:</p>
                    <div class="code-block">
                        <pre><code>import { render, screen, fireEvent } from '@testing-library/react';
import { vi } from 'vitest';
import Reports from '../Pages/Reports';

test('generates PDF when button clicked', async () => {
  const mockApi = vi.mocked(api);
  mockApi.get.mockResolvedValue({
    data: new Blob(['pdf'], { type: 'application/pdf' })
  });

  render(<Reports />);

  const generateButton = screen.getByText('Generate PDF');
  fireEvent.click(generateButton);

  await waitFor(() => {
    expect(mockApi.get).toHaveBeenCalledWith(
      '/api/reports/generate/hosts',
      expect.objectContaining({ responseType: 'blob' })
    );
  });
});</code></pre>
                    </div>

                    <h3>WebSocket Communication</h3>
                    <p>Test WebSocket connections and message handling:</p>
                    <div class="code-block">
                        <pre><code>def test_websocket_connection(client):
    with client.websocket_connect("/ws") as websocket:
        websocket.send_text("ping")
        data = websocket.receive_text()
        assert data == "pong"</code></pre>
                    </div>
                </section>

                <section class="docs-section">
                    <h2>Troubleshooting Tests</h2>

                    <h3>Common Issues</h3>

                    <div class="troubleshooting-item">
                        <h4>Playwright Installation Fails</h4>
                        <p><strong>Problem:</strong> Browser binaries fail to install</p>
                        <p><strong>Solution:</strong> Install system dependencies: <code>npx playwright install-deps</code></p>
                    </div>

                    <div class="troubleshooting-item">
                        <h4>Tests Fail in CI but Pass Locally</h4>
                        <p><strong>Problem:</strong> Environment differences between local and CI</p>
                        <p><strong>Solution:</strong> Check for timing issues, use proper wait strategies, ensure consistent test data</p>
                    </div>

                    <div class="troubleshooting-item">
                        <h4>Frontend Tests Can't Find Elements</h4>
                        <p><strong>Problem:</strong> React components not rendering properly in tests</p>
                        <p><strong>Solution:</strong> Use <code>await waitFor()</code> for async operations, check component mocking</p>
                    </div>

                    <div class="troubleshooting-item">
                        <h4>Database Tests Interfere with Each Other</h4>
                        <p><strong>Problem:</strong> Test database state affects other tests</p>
                        <p><strong>Solution:</strong> Use database transactions and rollback, or isolated test databases</p>
                    </div>

                    <h3>Debug Mode</h3>
                    <div class="code-block">
                        <pre><code># Debug backend tests
python -m pytest tests/test_specific.py -v -s --pdb

# Debug frontend tests
cd frontend && npm test -- --run=false

# Debug Playwright tests
npx playwright test --debug</code></pre>
                    </div>
                </section>

                <section class="docs-section">
                    <h2>Performance Testing</h2>

                    <p>While not part of the standard test suite, consider these tools for performance testing:</p>

                    <h3>Load Testing</h3>
                    <ul>
                        <li><strong>Locust:</strong> Python-based load testing for API endpoints</li>
                        <li><strong>Artillery:</strong> Modern load testing toolkit</li>
                        <li><strong>JMeter:</strong> Traditional load testing solution</li>
                    </ul>

                    <h3>Frontend Performance</h3>
                    <ul>
                        <li><strong>Lighthouse:</strong> Web performance auditing</li>
                        <li><strong>WebPageTest:</strong> Detailed performance analysis</li>
                        <li><strong>Playwright Performance:</strong> Performance metrics collection during E2E tests</li>
                    </ul>
                </section>
            </div>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <p>&copy; 2024 SysManage. Licensed under AGPLv3.</p>
        </div>
    </footer>
</body>
</html>